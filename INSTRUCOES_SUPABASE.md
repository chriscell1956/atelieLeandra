# Configuração do Banco de Dados (Supabase)

O código do seu site já está conectado ao Supabase! 
Agora, precisamos criar as tabelas lá no painel do Supabase para que os dados possam ser salvos.

## Passos para Criar as Tabelas

1.  Acesse o painel do seu projeto no Supabase: [https://supabase.com/dashboard/project/julstwfvftejnsxqafxs](https://supabase.com/dashboard/project/julstwfvftejnsxqafxs)
2.  No menu lateral esquerdo, clique no ícone **SQL Editor** (parece um terminal `>_`).
3.  Clique em **+ New query**.
4.  Copie TODO o código abaixo e cole na área de texto do SQL Editor:

```sql
-- Criar tabela de produtos
create table public.products (
  id text primary key,
  name text not null,
  price numeric not null,
  category text not null default 'Geral',
  is_highlight boolean default false,
  image_url text,
  description text,
  details jsonb,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Habilitar segurança (RLS)
alter table public.products enable row level security;

-- Políticas de acesso (Quem pode fazer o que)
create policy "Qualquer um pode ver produtos" on public.products
  for select using (true);

create policy "Apenas admin pode criar" on public.products
  for insert with check (auth.role() = 'authenticated');

create policy "Apenas admin pode editar" on public.products
  for update using (auth.role() = 'authenticated');

create policy "Apenas admin pode deletar" on public.products
  for delete using (auth.role() = 'authenticated');

-- Criar tabela do carrossel (Slides)
create table public.carousel_slides (
  id bigint generated by default as identity primary key,
  title text not null,
  subtitle text,
  image text not null,
  link text,
  button_text text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Habilitar segurança
alter table public.carousel_slides enable row level security;

-- Políticas
create policy "Qualquer um pode ver slides" on public.carousel_slides
  for select using (true);

create policy "Apenas admin pode gerenciar slides" on public.carousel_slides
  for all using (auth.role() = 'authenticated');
```

5.  Clique no botão **Run** (canto inferior direito ou superior).
6.  Se aparecer "Success" na parte de baixo, está pronto!

1.  Vá para o seu site (localhost).
2.  Tente fazer login com:
    *   **E-mail:** `leandraribeiro.lr.lr@gmail.com`
    *   **Senha:** `Chris195608#`

### Erro: "Email not confirmed"?
Se aparecer esse erro, é porque o Supabase exige confirmação de e-mail por padrão. Siga um dos caminhos abaixo:

**Opção A: Resolvendo via SQL (Mais rápido)**
1.  Acesse o **SQL Editor** no Supabase.
2.  Cole e execute este comando:
    ```sql
    update auth.users set email_confirmed_at = now() where email = 'leandraribeiro.lr.lr@gmail.com';
    ```

**Opção B: Desativando a exigência de confirmação**
1.  No Supabase, vá em **Authentication** > **Settings**.
2.  Procure por **Confirm email** e **DESATIVE** essa opção.
3.  Clique em **Save** no topo da página.

## Tabela de Usuários (Opcional para Perfil)
Execute este SQL se quiser garantir que a tabela de perfis extras exista:
```sql
create table public.users (
  id uuid references auth.users on delete cascade,
  email text primary key,
  name text,
  created_at timestamp with time zone default now()
);

-- Habilitar RLS
alter table public.users enable row level security;
create policy "Qualquer um pode ver perfis" on public.users for select using (true);
create policy "Apenas o próprio usuário pode editar" on public.users for update using (auth.uid() = id);
```

## Atualização: Controle de Estoque
Para ativar o controle de estoque, execute este comando no SQL Editor:
```sql
alter table public.products add column stock integer default 0;
```

## Nova Funcionalidade: Rastreamento de Visitas (Analytics)
Para saber quais produtos os clientes estão visitando, crie esta tabela:

```sql
create table public.access_logs (
  id bigint generated by default as identity primary key,
  product_id text references public.products(id),
  product_name text,
  user_email text, -- Opcional, se logado
  visited_at timestamp with time zone default now()
);

alter table public.access_logs enable row level security;

-- Todos podem criar logs (visitantes)
create policy "Visitantes criam logs" on public.access_logs
  for insert with check (true);

-- Apenas admin vê os logs
create policy "Admin vê logs" on public.access_logs
  for select using (auth.role() = 'authenticated');
```

## PERIGO: Como Zerar Tudo (Começar do Zero)
Se você quiser apagar **TODOS** os produtos e logs para começar limpo, rode este comando. **Cuidado, não há volta!**

```sql
-- Limpar logs de visitas
truncate table public.access_logs;

-- Limpar todos os produtos (Isso apaga TUDO que você cadastrou)
truncate table public.products cascade;
```
